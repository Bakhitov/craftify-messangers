# üõ†Ô∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏

## –ü—Ä–æ–±–ª–µ–º–∞
–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è endpoints –±—ã–ª–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞: **API —Å–µ—Ä–≤–µ—Ä—ã –≤–Ω—É—Ç—Ä–∏ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª–∏—Å—å**, —Ö–æ—Ç—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å —É—Å–ø–µ—à–Ω–æ.

### –°–∏–º–ø—Ç–æ–º—ã:
- ‚úÖ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è
- ‚ùå API —Å–µ—Ä–≤–µ—Ä—ã –Ω–µ –æ—Ç–≤–µ—á–∞—é—Ç –Ω–∞ –ø–æ—Ä—Ç–∞—Ö (7334, 7501, etc.)
- ‚ùå –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "API not responding yet, attempt X/60"
- ‚ùå Timeout –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ —á–µ—Ä–µ–∑ POST /api/v1/instances

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. üè• –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ Health Endpoints
**–ü—Ä–æ–±–ª–µ–º–∞**: –î–ª—è –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π endpoint `/api/health`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –í `src/instance-manager/services/compose.service.ts`
```typescript
// –î–û: –û–¥–∏–Ω endpoint –¥–ª—è –≤—Å–µ—Ö
const healthResponse = await axios.get(`http://localhost:${port}/api/health`);

// –ü–û–°–õ–ï: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ endpoints –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
let healthEndpoint: string;
if (instance.provider === 'telegram') {
  healthEndpoint = '/api/v1/telegram/health';
} else {
  healthEndpoint = '/api/v1/health'; // WhatsApp –∏ –¥—Ä—É–≥–∏–µ
}
```

### 2. üåê –ü—Ä–æ–±–ª–µ–º—ã —Å Networking
**–ü—Ä–æ–±–ª–µ–º–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `host.docker.internal` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API —Å —Ö–æ—Å—Ç–∞

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –í `src/instance-manager/services/compose.service.ts`
```typescript
// –î–û: 
const healthResponse = await axios.get(`http://host.docker.internal:${port}/api/health`);

// –ü–û–°–õ–ï:
const healthResponse = await axios.get(`http://localhost:${port}${healthEndpoint}`);
```

### 3. üîß –£–ª—É—á—à–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞ Docker
**–ü—Ä–æ–±–ª–µ–º–∞**: Telegram –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –ø–æ–ª—É—á–∞–ª–∏ bot token —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –í `src/instance-manager/utils/docker-compose.utils.ts`
```typescript
if (instance.provider === 'telegram') {
  command = [
    '-m', mode,
    '--log-level', 'debug',
    '--api-port', instance.port_api.toString(),
    ...(instance.token ? ['--telegram-bot-token', instance.token] : []),
  ];
}
```

### 4. üèóÔ∏è –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ health checks
**–ü—Ä–æ–±–ª–µ–º–∞**: Health check –ø–∞–¥–∞–ª –µ—Å–ª–∏ –Ω–µ —É–¥–∞–≤–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É endpoint

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –í `src/instance-manager/utils/connection.utils.ts`
```typescript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º /api/v1/health, –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è - –ø—Ä–æ–±—É–µ–º Telegram endpoint
try {
  const response = await fetch(`${url}/api/v1/health`);
  return response.ok;
} catch (error) {
  // Fallback –¥–ª—è Telegram
  const response = await fetch(`${url}/api/v1/telegram/health`);
  return response.ok;
}
```

### 5. üîÑ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –í `src/instance-manager/utils/docker-compose.utils.ts`
```typescript
// –ë–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
DATABASE_SSL: process.env.DATABASE_SSL || 'false',  // –±—ã–ª–æ 'true'
USE_SUPABASE: process.env.USE_SUPABASE || 'false',  // –±—ã–ª–æ 'true'
```

## üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –°–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `diagnose-containers.sh` –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

```bash
./diagnose-containers.sh
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
- ‚úÖ –°—Ç–∞—Ç—É—Å Docker –∏ docker-compose
- ‚úÖ –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Å–µ—Ç–∏ wweb-network
- ‚úÖ –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö WWEB –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API endpoints
- ‚úÖ –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- ‚úÖ –§–∞–π–ª—ã compose
- ‚úÖ –ó–∞–Ω—è—Ç—ã–µ –ø–æ—Ä—Ç—ã

### –†—É—á–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤**:
```bash
docker ps -a --filter "label=wweb.instance.id"
```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤**:
```bash
docker logs <container_name>
```

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ API**:
```bash
# WhatsApp
curl http://localhost:<port>/api/v1/health

# Telegram  
curl http://localhost:<port>/api/v1/telegram/health
```

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏**:
```bash
docker network ls | grep wweb-network
```

## üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

–ü–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Instance Manager**:
```bash
npm run dev
```

2. **–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä**:
```bash
curl -X POST http://localhost:3000/api/v1/instances \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "test_user",
    "provider": "whatsappweb",
    "type_instance": ["api"]
  }'
```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å**:
```bash
# –î–æ–∂–¥–∏—Ç–µ—Å—å —Å–æ–∑–¥–∞–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
sleep 30

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API
curl http://localhost:<assigned_port>/api/v1/health
```

## üéØ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚úÖ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –ò –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è
- ‚úÖ API —Å–µ—Ä–≤–µ—Ä—ã –æ—Ç–≤–µ—á–∞—é—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö endpoints
- ‚úÖ Health checks –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –≠–∫–∑–µ–º–ø–ª—è—Ä—ã –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –≤ —Å—Ç–∞—Ç—É—Å "ready"
- ‚úÖ Timeout –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –∏—Å–∫–ª—é—á–µ–Ω

## üÜò –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ï—Å–ª–∏ API –≤—Å–µ –µ—â–µ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç:
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `./diagnose-containers.sh`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ—Ä—Ç –Ω–µ –∑–∞–Ω—è—Ç –¥—Ä—É–≥–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env`

### –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Docker image: `docker images | grep wweb-mcp`
2. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ image: `docker build -t wweb-mcp:latest .`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç—å: `docker network ls | grep wweb-network`

### –ï—Å–ª–∏ –æ—à–∏–±–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `DATABASE_*` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
3. –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `host.docker.internal`

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

- [ ] Instance Manager –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å–æ–∑–¥–∞—é—Ç—Å—è
- [ ] API —Å–µ—Ä–≤–µ—Ä—ã –æ—Ç–≤–µ—á–∞—é—Ç –Ω–∞ health endpoints
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ timeout
- [ ] –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ ‚úÖ
- [ ] –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ  
**–î–∞—Ç–∞**: 23 –∏—é–ª—è 2025  
**–í–µ—Ä—Å–∏—è**: wweb-mcp v2.1+ 